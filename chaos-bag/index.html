<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Arkham Horror Chaos Bag Generator</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        touch-action: manipulation;
      }
      :root {
        --family: "Georgia", serif;
        --mono: "Berkeley Mono", Courier, monospace;
      }
      body {
        font-family: var(--family);
        background: linear-gradient(135deg, #2c1810, #4a2c17);
        color: #e8d5b7;
        margin: 0;
        padding: 20px;
        min-height: 100vh;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
        text-align: center;
      }

      h1,
      h3 {
        margin-bottom: 20px;
      }
      h3 {
        color: #d4af37;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
        font-size: 1.5em;
      }

      .controls {
        background: rgba(0, 0, 0, 0.3);
        padding: 20px;
        border-radius: 10px;
        margin-bottom: 30px;
        border: 2px solid #8b4513;
      }

      .difficulty-buttons {
        display: flex;
        justify-content: center;
        gap: 15px;
        margin-bottom: 20px;
        flex-wrap: wrap;
      }

      .difficulty-btn {
        padding: 12px 24px;
        border: 2px solid #8b4513;
        background: #2c1810;
        color: #e8d5b7;
        cursor: pointer;
        border-radius: 5px;
        font-size: 16px;
        transition: all 0.3s;
      }

      .difficulty-btn:hover {
        background: #8b4513;
        transform: translateY(-2px);
      }

      .difficulty-btn.active {
        background: #d4af37;
        color: #2c1810;
        font-weight: bold;
      }

      .generate-btn {
        padding: 15px 30px;
        background: #8b0000;
        color: white;
        border: none;
        border-radius: 5px;
        font-size: 18px;
        cursor: pointer;
        transition: all 0.3s;
      }

      .generate-btn:hover {
        background: #a50000;
        transform: scale(1.05);
      }

      .grid {
        display: grid;
        gap: 10px;
        justify-content: center;
        margin: 20px auto;
        max-width: 600px;
      }

      .grid-4x4 {
        grid-template-columns: repeat(4, 1fr);
      }

      .grid-4x5 {
        grid-template-columns: repeat(4, 1fr);
      }

      .token-cell {
        background: #1a1a1a;
        border: 2px solid #666;
        border-radius: 50%;
        padding: 15px;
        position: relative;
        min-height: 80px;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: flex-start;
      }

      .cell-number {
        background: #d4af37;
        color: #2c1810;
        width: 32px;
        height: 32px;
        border-radius: 5px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size-adjust: ex-height 0.43;
        font-family: var(--mono);
        font-weight: bold;
        font-size: 16px;
        border: 2px solid #2c1810;
        margin-bottom: 8px;
      }

      .token-image {
        width: 50px;
        height: 50px;
        object-fit: contain;
        margin-bottom: 5px;
      }

      .token-name {
        font-family: var(--mono);
        font-size: 28px;
        font-weight: bold;
        text-align: center;
        color: black;
        display: none;
      }

      .grid-toggle {
        margin: 20px 0;
      }

      .toggle-btn {
        padding: 8px 16px;
        margin: 0 5px;
        background: #2c1810;
        color: #e8d5b7;
        border: 2px solid #8b4513;
        border-radius: 5px;
        cursor: pointer;
      }

      .toggle-btn.active {
        background: #8b4513;
      }
      @media print {
        .controls,
        .token-image,
        h1,
        h3 {
          display: none;
        }
        .token-name {
          display: block;
        }
        .token-cell {
          border-radius: revert;
          border: none;
          border-right: 1px solid black;
          border-bottom: 1px solid black;
        }
        .token-cell:nth-child(4n) {
          border-right: none;
        }
        .cell-number {
          border: none;
          font-size: 60px;
          margin-bottom: 24px;
        }
        body,
        .token-cell,
        .cell-number {
          background: white;
        }
        .grid {
          margin: 0;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>Arkham Horror Chaos Bag Generator</h1>

      <div class="controls">
        <h3>Select Difficulty</h3>
        <div class="difficulty-buttons">
          <button class="difficulty-btn" data-difficulty="easy">Easy</button>
          <button class="difficulty-btn active" data-difficulty="standard">
            Standard
          </button>
          <button class="difficulty-btn" data-difficulty="hard">Hard</button>
          <button class="difficulty-btn" data-difficulty="expert">
            Expert
          </button>
        </div>

        <div class="grid-toggle">
          <span>Grid Size: </span>
          <button class="toggle-btn active" data-grid="4x4">4x4</button>
          <button class="toggle-btn" data-grid="4x5">4x5</button>
        </div>

        <button class="generate-btn" onclick="generateChaosBag()">
          Generate Chaos Bag
        </button>
      </div>

      <div class="grid-container" id="gridContainer" style="display: none">
        <h3>Chaos Bag Grid</h3>
        <div class="grid" id="tokenGrid"></div>
      </div>
    </div>

    <script>
      let selectedDifficulty = "standard";
      let selectedGrid = "4x4";

      // Chaos bag compositions for different difficulties
      const chaosBags = {
        easy: {
          "+1": 2,
          0: 3,
          "-1": 3,
          "-2": 2,
          skull: 2,
          cultist: 1,
          tablet: 1,
          elder_thing: 1,
          auto_fail: 1,
        },
        standard: {
          "+1": 1,
          0: 2,
          "-1": 3,
          "-2": 2,
          "-3": 1,
          skull: 2,
          cultist: 1,
          tablet: 2,
          elder_thing: 1,
          auto_fail: 1,
        },
        hard: {
          0: 1,
          "-1": 2,
          "-2": 2,
          "-3": 2,
          "-4": 1,
          skull: 3,
          cultist: 2,
          tablet: 2,
          elder_thing: 2,
          auto_fail: 1,
        },
        expert: {
          0: 1,
          "-1": 1,
          "-2": 2,
          "-3": 2,
          "-4": 2,
          "-5": 1,
          skull: 2,
          cultist: 2,
          tablet: 2,
          elder_thing: 2,
          auto_fail: 1,
        },
      };

      // Token display information
      const tokenInfo = {
        "+1": { name: "+1", image: "images/ct_plus1.png" },
        0: { name: "0", image: "images/ct_0.png" },
        "-1": { name: "-1", image: "images/ct_minus1.png" },
        "-2": { name: "-2", image: "images/ct_minus2.png" },
        "-3": { name: "-3", image: "images/ct_minus3.png" },
        "-4": { name: "-4", image: "images/ct_minus4.png" },
        "-5": { name: "-5", image: "images/ct_minus5.png" },
        skull: { name: "Skull", image: "images/ct_skull.png" },
        cultist: { name: "(Cu)", image: "images/ct_cultist.png" },
        tablet: { name: "Tablet", image: "images/ct_tablet.png" },
        elder_thing: { name: "Thing", image: "images/ct_elderthing.png" },
        auto_fail: { name: "Fail", image: "images/ct_autofail.png" },
        elder_sign: { name: "Sign", image: "images/ct_eldersign.png" },
      };

      // Event listeners for difficulty buttons
      document.querySelectorAll(".difficulty-btn").forEach((btn) => {
        btn.addEventListener("click", function () {
          document
            .querySelectorAll(".difficulty-btn")
            .forEach((b) => b.classList.remove("active"));
          this.classList.add("active");
          selectedDifficulty = this.dataset.difficulty;
        });
      });

      // Event listeners for grid toggle buttons
      document.querySelectorAll(".toggle-btn").forEach((btn) => {
        btn.addEventListener("click", function () {
          document
            .querySelectorAll(".toggle-btn")
            .forEach((b) => b.classList.remove("active"));
          this.classList.add("active");
          selectedGrid = this.dataset.grid;
        });
      });

      function generateChaosBag() {
        if (!selectedDifficulty) {
          alert("Please select a difficulty level first!");
          return;
        }

        const bagComposition = chaosBags[selectedDifficulty];
        let tokens = [];

        // Generate tokens based on composition
        for (const [tokenType, count] of Object.entries(bagComposition)) {
          for (let i = 0; i < count; i++) {
            tokens.push(tokenType);
          }
        }

        // Add elder sign token
        tokens.push("elder_sign");

        // Always use exactly 16 tokens
        const tokenCount = 16;

        if (tokens.length < tokenCount) {
          // Add more basic tokens if needed
          while (tokens.length < tokenCount) {
            tokens.push("0");
          }
        } else if (tokens.length > tokenCount) {
          // Remove excess tokens randomly
          while (tokens.length > tokenCount) {
            const randomIndex = Math.floor(Math.random() * tokens.length);
            tokens.splice(randomIndex, 1);
          }
        }

        // Shuffle the tokens
        for (let i = tokens.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [tokens[i], tokens[j]] = [tokens[j], tokens[i]];
        }

        displayGrid(tokens);
      }

      function displayGrid(tokens) {
        const grid = document.getElementById("tokenGrid");
        const gridContainer = document.getElementById("gridContainer");

        grid.innerHTML = "";
        grid.className = `grid grid-${selectedGrid}`;

        const totalCells = selectedGrid === "4x4" ? 16 : 20;
        const emptyCount = totalCells - 16; // Number of empty cells needed

        // Create array with tokens and empty cells
        let gridCells = [...tokens]; // 16 tokens

        // Add empty cells for 4x5 grid
        for (let i = 0; i < emptyCount; i++) {
          gridCells.push(null); // null represents empty cell
        }

        // Shuffle all cells (tokens + empty cells)
        for (let i = gridCells.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [gridCells[i], gridCells[j]] = [gridCells[j], gridCells[i]];
        }

        gridCells.forEach((token, index) => {
          const cell = document.createElement("div");
          cell.className = "token-cell";

          const cellNumber = document.createElement("div");
          cellNumber.className = "cell-number";
          cellNumber.textContent = index + 1;
          cell.appendChild(cellNumber);

          if (token === null) {
            // Empty cell
            const emptyLabel = document.createElement("div");
            emptyLabel.className = "token-name";
            emptyLabel.style.color = "#666";
            cell.appendChild(emptyLabel);
            cell.style.opacity = "0.5";
          } else {
            // Token cell
            const tokenImage = document.createElement("img");
            tokenImage.className = "token-image";
            tokenImage.src = tokenInfo[token].image;
            tokenImage.alt = tokenInfo[token].name;

            const tokenName = document.createElement("div");
            tokenName.className = "token-name";
            tokenName.textContent = tokenInfo[token].name;

            cell.appendChild(tokenImage);
            cell.appendChild(tokenName);
          }

          grid.appendChild(cell);
        });

        gridContainer.style.display = "block";
      }
    </script>
  </body>
</html>
